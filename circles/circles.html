<html>

<head>

</head>


<body">
  <canvas id="canvas" style="border: 1px solid" width="600" height="300"></canvas>
  <script src="classes.js"></script>

  <script>


    var MouseTouchTracker = function (canvas, callback) {

      function processEvent(evt) {
        var rect = canvas.getBoundingClientRect();
        var offsetTop = rect.top;
        var offsetLeft = rect.left;

        if (evt.touches) {
          return {
            x: evt.touches[0].clientX - offsetLeft,
            y: evt.touches[0].clientY - offsetTop
          }
        } else {
          return {
            x: evt.clientX - offsetLeft,
            y: evt.clientY - offsetTop
          }
        }
      }

      function onDown(evt) {
        evt.preventDefault();
        var coords = processEvent(evt);
        callback('down', coords.x, coords.y);
      }

      function onUp(evt) {
        evt.preventDefault();
        callback('up');
      }

      function onMove(evt) {
        evt.preventDefault();
        var coords = processEvent(evt);
        callback('move', coords.x, coords.y);
      }

      canvas.ontouchmove = onMove;
      canvas.onmousemove = onMove;

      canvas.ontouchstart = onDown;
      canvas.onmousedown = onDown;
      canvas.ontouchend = onUp;
      canvas.onmouseup = onUp;
    }

    function isHit(shape, x, y) {
      if (shape.constructor.name === 'circle') {
        var dx = shape.x - x;
        var dy = shape.y - y;
        if (dx * dx + dy * dy < shape.radius * shape.radius) {
          return true
        }
      } else {
        if (x > shape.x && y > shape.y && x < shape.x + shape.width && y < shape.y + shape.height) {
          return true;
        }
      }

      return false;
    }

    var canvas = document.getElementById('canvas');
    var ctx = canvas.getContext('2d');
    var startX = 0;
    var startY = 0;

    var rectangle1 = new rectangle(50, 50, 100, 100, '#00FF00');
    rectangle1.render(ctx);

    var circle1 = new circle(200, 140, 50, '#F00000');
    circle1.render(ctx);

    var mtt = new MouseTouchTracker(canvas,
      function (evtType, x, y) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        switch (evtType) {

          case 'down':
            startX = x;
            startY = y;
            rectangle1.isDragging = isHit(rectangle1, x, y);
            circle1.isDragging = isHit(circle1, x, y);
            break;

          case 'up':
            rectangle1.isDragging = false;
            circle1.isDragging = false;
            break;

          case 'move':
            var dx = x - startX;
            var dy = y - startY;
            startX = x;
            startY = y;

            if (rectangle1.isDragging) {
              rectangle1.x += dx;
              rectangle1.y += dy;
            }

            if (circle1.isDragging) {
              circle1.x += dx;
              circle1.y += dy;
            }
            break;
        }

        circle1.render(ctx);
        rectangle1.render(ctx);
      }
    );

  </script>
  </body>

</html>